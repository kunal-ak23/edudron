databaseChangeLog:
  - changeSet:
      id: password-reset-0001
      author: edudron
      changes:
        # Step 1: Add column as nullable (IF NOT EXISTS handles existing column)
        - sql:
            sql: ALTER TABLE idp.users ADD COLUMN IF NOT EXISTS password_reset_required BOOLEAN
        # Step 2: Initialize all null values to false (default value)
        - sql:
            sql: UPDATE idp.users SET password_reset_required = false WHERE password_reset_required IS NULL
        # Step 3: Add NOT NULL constraint
        - sql:
            sql: ALTER TABLE idp.users ALTER COLUMN password_reset_required SET NOT NULL
        # Step 4: Set default value
        - sql:
            sql: ALTER TABLE idp.users ALTER COLUMN password_reset_required SET DEFAULT false
